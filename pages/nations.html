<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="RF åœ‹ç­–è³‡è¨Š - å„é™£ç‡Ÿåœ‹ç­–ä¸€è¦½ï¼ŒæŸ¥çœ‹æˆ°åŠ›åŠ æˆèˆ‡æœ¬åœ°æ´åŠ©æ•ˆæœ">
    <title>åœ‹ç­–è³‡è¨Š - RF æ”»ç•¥ç¶²ç«™</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .nation-card {
            border-radius: 15px;
            overflow: hidden;
            transition: var(--transition);
        }

        .nation-card:hover {
            transform: scale(1.02);
        }

        .nation-header {
            padding: 20px;
            color: white;
            text-align: center;
        }

        .nation-header h3 {
            margin: 0;
            font-size: 1.5em;
        }

        .nation-header .subtitle {
            opacity: 0.9;
            margin-top: 5px;
            font-size: 0.9em;
        }

        .nation-body {
            padding: 20px;
            background: var(--card-bg);
            color: var(--text-color);
        }

        .strategy-card {
            background: var(--light-bg);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .strategy-card h4 {
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .strategy-card p {
            font-size: 0.9em;
            color: var(--muted-text);
        }

        .effect-tag {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            margin: 2px;
        }

        .effect-atk {
            background: #ffcccc;
            color: #c0392b;
        }

        .effect-def {
            background: #cce5ff;
            color: #2980b9;
        }

        .effect-aid {
            background: #ccffcc;
            color: #27ae60;
        }

        .nation-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .nation-stat {
            text-align: center;
        }

        .nation-stat .value {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--primary-color);
        }

        .nation-stat .label {
            font-size: 0.8em;
            color: var(--muted-text);
        }
    </style>
</head>

<body>
    <!-- å°èˆªæ¬„ -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="../index.html" class="navbar-brand">
                âš”ï¸ RF æ”»ç•¥ç¶²ç«™
            </a>
            <button class="navbar-toggle" onclick="toggleMenu()">â˜°</button>
            <ul class="navbar-menu" id="navMenu">
                <li><a href="../index.html">é¦–é </a></li>
                <li><a href="cities.html">åŸé®è³‡è¨Š</a></li>
                <li><a href="characters.html">è§’è‰²è³‡è¨Š</a></li>
                <li><a href="calculator.html">æˆ°åŠ›è¨ˆç®—å™¨</a></li>
                <li><a href="guide.html">æ–°æ‰‹æ•™å­¸</a></li>
                <li><a href="query.html">æŸ¥è©¢åŠŸèƒ½</a></li>
                <li><a href="nations.html" class="active">åœ‹ç­–è³‡è¨Š</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="content-wrapper">
            <div class="page-header">
                <h1>ğŸ´ åœ‹ç­–è³‡è¨Š</h1>
                <p>å„é™£ç‡Ÿåœ‹ç­–ä¸€è¦½ï¼ŒæŸ¥çœ‹æˆ°åŠ›åŠ æˆèˆ‡æœ¬åœ°æ´åŠ©æ•ˆæœ</p>
            </div>

            <!-- ç¯©é¸ -->
            <div class="card" style="margin-bottom: 25px;">
                <div class="card-body">
                    <div class="grid grid-3">
                        <div class="form-group">
                            <label class="form-label">é™£ç‡Ÿç¯©é¸</label>
                            <select class="form-control" id="nationFilter" onchange="filterNations()">
                                <option value="">å…¨éƒ¨é™£ç‡Ÿ</option>
                                <option value="1">ç´…è»</option>
                                <option value="2">è‡ºç£</option>
                                <option value="3">é¦™æ¸¯</option>
                                <option value="4">è—åœ‹</option>
                                <option value="5">ç¶­å¾çˆ¾</option>
                                <option value="6">å“ˆè–©å…‹</option>
                                <option value="7">æ»¿æ´²</option>
                                <option value="8">è’™å¤</option>
                                <option value="10">åè³Šè¯ç›Ÿ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">è¯ç›Ÿ</label>
                            <select class="form-control" id="allianceFilter" onchange="filterNations()">
                                <option value="">å…¨éƒ¨è¯ç›Ÿ</option>
                                <option value="åå…±é™£ç‡Ÿ">åå…±é™£ç‡Ÿ</option>
                                <option value="å…±ç”¢é™£ç‡Ÿ">å…±ç”¢é™£ç‡Ÿ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ’åº</label>
                            <select class="form-control" id="sortFilter" onchange="filterNations()">
                                <option value="players">ç©å®¶æ•¸é‡</option>
                                <option value="cities">åŸé®æ•¸é‡</option>
                                <option value="name">åç¨±</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- é™£ç‡Ÿåˆ—è¡¨ -->
            <div id="nationsContainer">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 15px;">è¼‰å…¥åœ‹ç­–è³‡æ–™ä¸­...</p>
                </div>
            </div>

            <!-- å¤–äº¤åœ‹ç­–èªªæ˜ -->
            <div class="card" style="margin-top: 30px;">
                <div class="card-header">
                    <span class="card-title">ğŸ“œ å¤–äº¤åœ‹ç­–èªªæ˜</span>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table class="table" id="diplomaticTable">
                            <thead>
                                <tr>
                                    <th>åœ‹ç­–åç¨±</th>
                                    <th>æ•ˆæœèªªæ˜</th>
                                </tr>
                            </thead>
                            <tbody id="diplomaticBody">
                                <!-- ç”± JS å¡«å…… -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- é€šç”¨åœ‹ç­–èªªæ˜ -->
            <div class="card" style="margin-top: 25px;">
                <div class="card-header">
                    <span class="card-title">âš™ï¸ é€šç”¨åœ‹ç­–èªªæ˜</span>
                </div>
                <div class="card-body">
                    <div class="accordion" id="generalStrategiesAccordion">
                        <!-- ç”± JS å¡«å…… -->
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <p>RF æ”»ç•¥ç¶²ç«™ | ä½¿ç”¨ GitHub Pages å»ºç½®</p>
        </footer>
    </div>

    <script src="../js/app.js"></script>
    <script>
        // åœ‹ç­–è³‡æ–™ï¼ˆå°‡å¾ JSON è¼‰å…¥ï¼‰
        let nationsData = [];
        let diplomaticStrategies = [];
        let generalStrategies = [];
        let allGeneralStrategiesFlat = []; // æ‰å¹³åŒ–çš„æ‰€æœ‰åœ‹ç­– ID -> åç¨±å°ç…§

        // å¾ JSON è¼‰å…¥è³‡æ–™
        async function loadNationsData() {
            try {
                // åŠ å…¥æ™‚é–“æˆ³é¿å…å¿«å–å•é¡Œ
                const timestamp = new Date().getTime();
                const response = await fetch(`../return_data_example/nation.json?t=${timestamp}`);
                const rawData = await response.json();

                // è§£æ WebSocket æ ¼å¼çš„ JSON
                // æ ¼å¼: ["6","14","player:815058","phx_reply",{"status":"ok","response":{...}}]
                let data;
                if (Array.isArray(rawData) && rawData.length >= 5) {
                    data = rawData[4]?.response || rawData[4];
                } else if (rawData.response) {
                    data = rawData.response;
                } else {
                    data = rawData;
                }

                // è¼‰å…¥å¤–äº¤åœ‹ç­–
                if (data.diplomatic_strategies) {
                    diplomaticStrategies = data.diplomatic_strategies.map(s => ({
                        id: s.id,
                        name: s.name,
                        description: s.description,
                        image: s.image
                    }));
                }

                // è¼‰å…¥é€šç”¨åœ‹ç­–ï¼ˆå»ºç«‹æ‰å¹³åŒ–å°ç…§è¡¨ï¼‰
                if (data.general_strategies) {
                    generalStrategies = data.general_strategies;

                    // å»ºç«‹æ‰€æœ‰åœ‹ç­–çš„ ID -> è³‡æ–™å°ç…§
                    data.general_strategies.forEach(gs => {
                        allGeneralStrategiesFlat.push({
                            id: gs.id,
                            name: gs.name,
                            description: gs.description,
                            image: gs.image,
                            level: 0
                        });

                        if (gs.general_strategy_routes) {
                            gs.general_strategy_routes.forEach(route => {
                                if (route.level_1_general_strategy) {
                                    allGeneralStrategiesFlat.push({
                                        id: route.level_1_general_strategy.id,
                                        name: route.level_1_general_strategy.name,
                                        description: route.level_1_general_strategy.description,
                                        image: route.level_1_general_strategy.image,
                                        level: 1
                                    });
                                }
                                if (route.level_2_general_strategy) {
                                    allGeneralStrategiesFlat.push({
                                        id: route.level_2_general_strategy.id,
                                        name: route.level_2_general_strategy.name,
                                        description: route.level_2_general_strategy.description,
                                        image: route.level_2_general_strategy.image,
                                        level: 2
                                    });
                                }
                                if (route.level_3_general_strategy) {
                                    allGeneralStrategiesFlat.push({
                                        id: route.level_3_general_strategy.id,
                                        name: route.level_3_general_strategy.name,
                                        description: route.level_3_general_strategy.description,
                                        image: route.level_3_general_strategy.image,
                                        level: 3
                                    });
                                }
                            });
                        }
                    });
                }

                // è¼‰å…¥åœ‹å®¶è³‡æ–™
                if (data.nations) {
                    nationsData = data.nations.map(nation => {
                        // æ‰¾å‡ºç•¶å‰å¤–äº¤åœ‹ç­–åç¨±
                        const currentDiplomaticStrategy = diplomaticStrategies.find(d => d.id === nation.diplomatic_strategy_id);

                        // æ‰¾å‡ºå·²é¸å–çš„é€šç”¨åœ‹ç­–
                        const selectedStrategies = (nation.general_strategy_ids || [])
                            .map(id => allGeneralStrategiesFlat.find(s => s.id === id))
                            .filter(s => s);

                        return {
                            id: nation.id,
                            name: nation.headquarters || nation.origin?.replace('å‡ºèº«', '') || `é™£ç‡Ÿ ${nation.id}`,
                            subtitle: nation.title || nation.description_title || '',
                            description: nation.description || '',
                            alliance: nation.alliance || '',
                            players: nation.players || 0,
                            cities: nation.cities || 0,
                            controlCities: nation.control_cities || nation.controll_cities || 0,
                            capital: nation.capital?.name || '',
                            color: nation.city_color ? `#${nation.city_color}` : '#666',
                            diplomaticStrategy: currentDiplomaticStrategy?.name || 'ç„¡',
                            diplomaticStrategyDesc: currentDiplomaticStrategy?.description || '',
                            slogan: nation.commander_words || [],
                            flag: nation.flag,
                            icon: nation.icon,
                            seal: nation.seal,
                            commander: nation.commander,
                            selectedStrategies: selectedStrategies,
                            selectableStrategyIds: nation.selectable_general_strategy_ids || [],
                            diplomaticStrategyIds: nation.diplomatic_strategy_ids || []
                        };
                    });
                }

                // æ¸²æŸ“é é¢
                renderNations(nationsData);
                renderDiplomaticStrategies();
                renderGeneralStrategies();

            } catch (error) {
                console.error('è¼‰å…¥åœ‹ç­–è³‡æ–™å¤±æ•—:', error);
                document.getElementById('nationsContainer').innerHTML = `
                    <div class="alert alert-danger">
                        è¼‰å…¥åœ‹ç­–è³‡æ–™å¤±æ•—ï¼Œè«‹ç¢ºèª nation.json æª”æ¡ˆå­˜åœ¨ä¸”æ ¼å¼æ­£ç¢ºã€‚<br>
                        éŒ¯èª¤ï¼š${error.message}
                    </div>
                `;
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            loadNationsData();
        });

        // è§£æåœ‹ç­–æ•ˆæœï¼ˆå¾æè¿°ä¸­æå–æ•¸å€¼ï¼‰
        function parseStrategyEffects(description) {
            if (!description) return null;

            const effects = {
                atkBoost: 0,        // æˆ‘æ–¹æ“šé»æˆ°æˆ°åŠ›å¢åŠ 
                enemyReduction: 0,  // æ•µæ–¹æˆ°åŠ›æ¸›å°‘
                aidBoost: {},       // æœ¬åœ°æ´åŠ©å¢åŠ ï¼ˆæŒ‰ä¾†æºï¼‰
                moveTimeReduction: 0, // ç§»å‹•æ™‚é–“æ¸›å°‘
                assemblyTimeReduction: 0, // é›†çµæ™‚é–“æ¸›å°‘
                classBoosts: {}     // å„è·æ¥­åŠ æˆ
            };

            // è§£ææˆ‘æ–¹æˆ°åŠ›å¢åŠ 
            const atkMatch = description.match(/æˆ‘æ–¹(?:æ“šé»æˆ°)?æˆ°åŠ›å¢åŠ (\d+)%/g);
            if (atkMatch) {
                atkMatch.forEach(m => {
                    const val = m.match(/(\d+)%/);
                    if (val) effects.atkBoost += parseInt(val[1]);
                });
            }

            // è§£ææ•µæ–¹æˆ°åŠ›æ¸›å°‘
            const defMatch = description.match(/æ•µæ–¹(?:æ“šé»æˆ°)?æˆ°åŠ›æ¸›å°‘(\d+)%/g);
            if (defMatch) {
                defMatch.forEach(m => {
                    const val = m.match(/(\d+)%/);
                    if (val) effects.enemyReduction += parseInt(val[1]);
                });
            }

            // è§£ææœ¬åœ°æ´åŠ©å¢åŠ 
            const aidMatch = description.match(/(.+?)æœ¬åœ°æ´åŠ©å¢åŠ (\d+)%/g);
            if (aidMatch) {
                aidMatch.forEach(m => {
                    const parts = m.match(/(.+?)æœ¬åœ°æ´åŠ©å¢åŠ (\d+)%/);
                    if (parts) {
                        const source = parts[1].trim();
                        effects.aidBoost[source] = (effects.aidBoost[source] || 0) + parseInt(parts[2]);
                    }
                });
            }

            // å…¨åœ°åœ–æœ¬åœ°æ´åŠ©
            const allAidMatch = description.match(/å…¨åœ°åœ–æœ¬åœ°æ´åŠ©å¢åŠ (\d+)%/g);
            if (allAidMatch) {
                allAidMatch.forEach(m => {
                    const val = m.match(/(\d+)%/);
                    if (val) effects.aidBoost['å…¨åœ°åœ–'] = (effects.aidBoost['å…¨åœ°åœ–'] || 0) + parseInt(val[1]);
                });
            }

            // è§£æè·æ¥­åŠ æˆ
            const classTypes = ['æ¸¸æ“ŠéšŠ', 'å·¥å…µ', 'é†«ç™‚å…µ', 'æ­¥å…µ', 'ç‹™æ“Šæ‰‹', 'çªæ“ŠéšŠ', 'ç ²å…µ', 'å®£å‚³å®¶', 'è³‡åŠ©è€…', 'é–“è«œ'];
            classTypes.forEach(type => {
                const regex = new RegExp(`${type}æ“šé»æˆ°æˆ°åŠ›å¢åŠ (\\d+)%`, 'g');
                const matches = description.match(regex);
                if (matches) {
                    matches.forEach(m => {
                        const val = m.match(/(\d+)%/);
                        if (val) effects.classBoosts[type] = (effects.classBoosts[type] || 0) + parseInt(val[1]);
                    });
                }
            });

            // è§£ææ™‚é–“æ¸›å°‘
            const moveMatch = description.match(/ç§»å‹•æ™‚é–“æ¸›å°‘(\d+)%/);
            if (moveMatch) effects.moveTimeReduction += parseInt(moveMatch[1]);

            const assemblyMatch = description.match(/é›†çµæ™‚é–“æ¸›å°‘(\d+)%/);
            if (assemblyMatch) effects.assemblyTimeReduction += parseInt(assemblyMatch[1]);

            return effects;
        }

        // è¨ˆç®—åœ‹å®¶çš„ç¸½æ•ˆæœ
        function calculateTotalEffects(nation) {
            const totalEffects = {
                atkBoost: 0,
                enemyReduction: 0,
                aidBoost: {},
                moveTimeReduction: 0,
                assemblyTimeReduction: 0,
                classBoosts: {}
            };

            // ç´¯åŠ å¤–äº¤åœ‹ç­–æ•ˆæœ
            if (nation.diplomaticStrategyDesc) {
                const diplomatic = parseStrategyEffects(nation.diplomaticStrategyDesc);
                if (diplomatic) {
                    totalEffects.atkBoost += diplomatic.atkBoost;
                    totalEffects.enemyReduction += diplomatic.enemyReduction;
                    Object.keys(diplomatic.aidBoost).forEach(k => {
                        totalEffects.aidBoost[k] = (totalEffects.aidBoost[k] || 0) + diplomatic.aidBoost[k];
                    });
                }
            }

            // ç´¯åŠ é€šç”¨åœ‹ç­–æ•ˆæœ
            if (nation.selectedStrategies) {
                nation.selectedStrategies.forEach(strategy => {
                    const effects = parseStrategyEffects(strategy.description);
                    if (effects) {
                        totalEffects.atkBoost += effects.atkBoost;
                        totalEffects.enemyReduction += effects.enemyReduction;
                        totalEffects.moveTimeReduction += effects.moveTimeReduction;
                        totalEffects.assemblyTimeReduction += effects.assemblyTimeReduction;
                        Object.keys(effects.aidBoost).forEach(k => {
                            totalEffects.aidBoost[k] = (totalEffects.aidBoost[k] || 0) + effects.aidBoost[k];
                        });
                        Object.keys(effects.classBoosts).forEach(k => {
                            totalEffects.classBoosts[k] = (totalEffects.classBoosts[k] || 0) + effects.classBoosts[k];
                        });
                    }
                });
            }

            return totalEffects;
        }

        // ç”Ÿæˆæ•ˆæœçµ±è¨ˆè¡¨æ ¼ HTML
        function generateEffectsTable(effects) {
            const rows = [];

            if (effects.atkBoost > 0) {
                rows.push(`<tr><td>ğŸ—¡ï¸ æˆ‘æ–¹æ“šé»æˆ°æˆ°åŠ›</td><td class="effect-atk">+${effects.atkBoost}%</td></tr>`);
            }
            if (effects.enemyReduction > 0) {
                rows.push(`<tr><td>ğŸ›¡ï¸ æ•µæ–¹æˆ°åŠ›æ¸›å°‘</td><td class="effect-def">-${effects.enemyReduction}%</td></tr>`);
            }
            if (effects.moveTimeReduction > 0) {
                rows.push(`<tr><td>ğŸƒ ç§»å‹•æ™‚é–“æ¸›å°‘</td><td>-${effects.moveTimeReduction}%</td></tr>`);
            }
            if (effects.assemblyTimeReduction > 0) {
                rows.push(`<tr><td>â±ï¸ é›†çµæ™‚é–“æ¸›å°‘</td><td>-${effects.assemblyTimeReduction}%</td></tr>`);
            }

            // æœ¬åœ°æ´åŠ©
            Object.keys(effects.aidBoost).forEach(source => {
                rows.push(`<tr><td>ğŸ¤ ${source}æœ¬åœ°æ´åŠ©</td><td class="effect-aid">+${effects.aidBoost[source]}%</td></tr>`);
            });

            // è·æ¥­åŠ æˆï¼ˆåªé¡¯ç¤ºæœ‰åŠ æˆçš„ï¼‰
            Object.keys(effects.classBoosts).forEach(classType => {
                rows.push(`<tr><td>ğŸ‘¤ ${classType}æˆ°åŠ›</td><td>+${effects.classBoosts[classType]}%</td></tr>`);
            });

            if (rows.length === 0) {
                return '<p style="color: var(--muted-text); font-size: 0.9em;">æœªé¸å–æœ‰æ•ˆåœ‹ç­–</p>';
            }

            return `
                <table class="table" style="font-size: 0.85em;">
                    <thead>
                        <tr><th>æ•ˆæœé¡å‹</th><th>æ•¸å€¼</th></tr>
                    </thead>
                    <tbody>
                        ${rows.join('')}
                    </tbody>
                </table>
            `;
        }

        // ç¯©é¸åœ‹å®¶
        function filterNations() {
            const nationFilter = document.getElementById('nationFilter').value;
            const allianceFilter = document.getElementById('allianceFilter').value;
            const sortFilter = document.getElementById('sortFilter').value;

            let filtered = nationsData.filter(nation => {
                const matchNation = !nationFilter || nation.id == nationFilter;
                const matchAlliance = !allianceFilter || nation.alliance === allianceFilter;
                return matchNation && matchAlliance;
            });

            // æ’åº
            filtered.sort((a, b) => {
                switch (sortFilter) {
                    case 'cities':
                        return b.cities - a.cities;
                    case 'name':
                        return a.name.localeCompare(b.name, 'zh-TW');
                    default:
                        return b.players - a.players;
                }
            });

            renderNations(filtered);
        }

        // æ¸²æŸ“åœ‹å®¶åˆ—è¡¨
        function renderNations(nations) {
            const container = document.getElementById('nationsContainer');

            if (nations.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„é™£ç‡Ÿ</div>
                `;
                return;
            }

            container.innerHTML = `
                <p style="margin-bottom: 15px; color: var(--muted-text);">å…± ${nations.length} å€‹é™£ç‡Ÿ</p>
                <div class="grid grid-2">
                    ${nations.map(nation => `
                        <div class="card nation-card">
                            <div class="nation-header" style="background: ${nation.color}; ${nation.color === '#ffffff' || nation.color === '#fcb900' || nation.color === '#00e9e4' ? 'color: #333;' : ''}">
                                ${nation.icon ? `<img src="${getAssetPath(nation.icon)}" alt="${nation.name}" style="width: 48px; height: 48px; margin-bottom: 10px;">` : ''}
                                <h3>${nation.name}</h3>
                                <div class="subtitle">${nation.subtitle}</div>
                            </div>
                            <div class="nation-body">
                                <p style="margin-bottom: 15px;">${nation.description}</p>
                                
                                <div class="strategy-card">
                                    <h4>ğŸ´ ç•¶å‰å¤–äº¤åœ‹ç­–</h4>
                                    <p><strong>${nation.diplomaticStrategy}</strong></p>
                                    ${nation.diplomaticStrategyDesc ? `<p style="font-size: 0.85em; color: var(--muted-text);">${nation.diplomaticStrategyDesc}</p>` : ''}
                                </div>
                                
                                ${nation.selectedStrategies && nation.selectedStrategies.length > 0 ? `
                                    <div class="strategy-card" style="margin-top: 10px;">
                                        <h4>âš™ï¸ å·²é¸å–é€šç”¨åœ‹ç­– (${nation.selectedStrategies.length})</h4>
                                        <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px;">
                                            ${nation.selectedStrategies.slice(0, 10).map(s => `
                                                <span class="badge badge-info" title="${s.description || ''}">${s.name}</span>
                                            `).join('')}
                                            ${nation.selectedStrategies.length > 10 ? `<span class="badge badge-muted">+${nation.selectedStrategies.length - 10} æ›´å¤š</span>` : ''}
                                        </div>
                                        <button class="btn btn-sm btn-outline" style="margin-top: 10px;" onclick="showAllStrategies(${nation.id})">
                                            æŸ¥çœ‹å…¨éƒ¨åœ‹ç­–
                                        </button>
                                    </div>
                                ` : ''}
                                
                                <div class="strategy-card" style="margin-top: 10px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);">
                                    <h4>ğŸ“Š ç›®å‰ç”Ÿæ•ˆåœ‹ç­–åŠ æˆçµ±è¨ˆ</h4>
                                    <div style="margin-top: 10px;">
                                        ${generateEffectsTable(calculateTotalEffects(nation))}
                                    </div>
                                </div>
                                
                                <div style="margin: 15px 0;">
                                    <span class="badge ${nation.alliance === 'åå…±é™£ç‡Ÿ' ? 'badge-primary' : 'badge-danger'}">${nation.alliance || 'æœªçŸ¥è¯ç›Ÿ'}</span>
                                    ${nation.capital ? `<span class="badge badge-success">é¦–éƒ½ï¼š${nation.capital}</span>` : ''}
                                </div>
                                
                                <div class="nation-stats">
                                    <div class="nation-stat">
                                        <div class="value">${nation.players.toLocaleString()}</div>
                                        <div class="label">ç©å®¶æ•¸</div>
                                    </div>
                                    <div class="nation-stat">
                                        <div class="value">${nation.cities}</div>
                                        <div class="label">åŸé®æ•¸</div>
                                    </div>
                                    <div class="nation-stat">
                                        <div class="value">${nation.controlCities}</div>
                                        <div class="label">æ§åˆ¶åŸé®</div>
                                    </div>
                                </div>
                                
                                ${nation.commander ? `
                                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                                        <p style="font-size: 0.9em; color: var(--muted-text);">
                                            <strong>çµ±å¸¥ï¼š</strong>${nation.commander.name} (${nation.commander.title})
                                        </p>
                                        <p style="font-size: 0.85em; color: var(--muted-text);">
                                            è»åœ˜ï¼š${nation.commander.union}
                                        </p>
                                    </div>
                                ` : ''}
                                
                                ${nation.slogan && nation.slogan.length > 0 ? `
                                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color); font-style: italic; color: var(--muted-text); text-align: center;">
                                        ã€Œ${nation.slogan[0]}ã€
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // é¡¯ç¤ºå…¨éƒ¨åœ‹ç­– Modal
        function showAllStrategies(nationId) {
            const nation = nationsData.find(n => n.id === nationId);
            if (!nation || !nation.selectedStrategies) return;

            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; z-index: 2000;';

            modal.innerHTML = `
                <div style="background: var(--card-bg); color: var(--text-color); padding: 30px; border-radius: 15px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);">
                    <h2 style="color: var(--primary-color); margin-bottom: 20px;">
                        ${nation.name} - å·²é¸å–é€šç”¨åœ‹ç­–
                    </h2>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>åœ‹ç­–åç¨±</th>
                                    <th>æ•ˆæœèªªæ˜</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${nation.selectedStrategies.map(s => `
                                    <tr>
                                        <td><strong>${s.name}</strong></td>
                                        <td>${s.description || '-'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 20px;" onclick="this.closest('.modal').remove()">
                        é—œé–‰
                    </button>
                </div>
            `;

            modal.addEventListener('click', function (e) {
                if (e.target === modal) modal.remove();
            });

            document.body.appendChild(modal);
        }

        // æ¸²æŸ“å¤–äº¤åœ‹ç­–è¡¨
        function renderDiplomaticStrategies() {
            const tbody = document.getElementById('diplomaticBody');
            if (diplomaticStrategies.length === 0) {
                tbody.innerHTML = '<tr><td colspan="2">è¼‰å…¥ä¸­...</td></tr>';
                return;
            }
            tbody.innerHTML = diplomaticStrategies.map(strategy => `
                <tr>
                    <td>
                        ${strategy.image ? `<img src="${getAssetPath(strategy.image)}" alt="${strategy.name}" style="width: 32px; height: 32px; vertical-align: middle; margin-right: 8px;">` : ''}
                        <strong>${strategy.name}</strong>
                    </td>
                    <td>${strategy.description}</td>
                </tr>
            `).join('');
        }

        // æ¸²æŸ“é€šç”¨åœ‹ç­–
        function renderGeneralStrategies() {
            const accordion = document.getElementById('generalStrategiesAccordion');
            if (generalStrategies.length === 0) {
                accordion.innerHTML = '<p>è¼‰å…¥ä¸­...</p>';
                return;
            }
            accordion.innerHTML = generalStrategies.map(strategy => `
                <div class="accordion-item">
                    <button class="accordion-header" onclick="toggleStrategyAccordion(this)">
                        ${strategy.image ? `<img src="${getAssetPath(strategy.image)}" alt="${strategy.name}" style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;">` : ''}
                        <strong>${strategy.name}</strong> - ${(strategy.description || '').replace(/<br\/?>/g, ' | ')}
                    </button>
                    <div class="accordion-body">
                        <h4 style="margin-bottom: 15px;">é€²éšè·¯ç·šï¼š</h4>
                        ${strategy.general_strategy_routes ? strategy.general_strategy_routes.map(route => {
                const levels = [];
                if (route.level_1_general_strategy) levels.push(route.level_1_general_strategy);
                if (route.level_2_general_strategy) levels.push(route.level_2_general_strategy);
                if (route.level_3_general_strategy) levels.push(route.level_3_general_strategy);

                if (levels.length === 0) return '';

                return `
                                <div class="strategy-card">
                                    <h4>${levels.map(l => l.name).join(' â†’ ')}</h4>
                                    <div style="margin-top: 10px;">
                                        ${levels.map(l => `
                                            <div style="margin-bottom: 8px; padding-left: 15px; border-left: 3px solid var(--primary-color);">
                                                <strong>${l.name}ï¼š</strong>
                                                <span style="color: var(--muted-text);">${l.description || '-'}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `;
            }).join('') : '<p>ç„¡é€²éšè·¯ç·šè³‡æ–™</p>'}
                    </div>
                </div>
            `).join('');
        }

        // åˆ‡æ›æ‘ºç–Š
        function toggleStrategyAccordion(header) {
            header.classList.toggle('active');
            const body = header.nextElementSibling;
            body.classList.toggle('active');
        }
    </script>
</body>

</html>