<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="RF è§’è‰²è³‡è¨Š - å®Œæ•´è§’è‰²æ•¸æ“šï¼ŒåŒ…å«è·æ¥­ã€é™£ç‡Ÿã€å¤©è³¦è¡¨ã€ç¬¦æ–‡é¡å‹ã€ç­‰ç´šæ•¸å€¼">
    <title>è§’è‰²è³‡è¨Š - RF æ”»ç•¥ç¶²ç«™</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <!-- å°èˆªæ¬„ -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="../index.html" class="navbar-brand">
                âš”ï¸ RF æ”»ç•¥ç¶²ç«™
            </a>
            <button class="navbar-toggle" onclick="toggleMenu()">â˜°</button>
            <ul class="navbar-menu" id="navMenu">
                <li><a href="../index.html">é¦–é </a></li>
                <li><a href="cities.html">åŸé®è³‡è¨Š</a></li>
                <li><a href="characters.html" class="active">è§’è‰²è³‡è¨Š</a></li>
                <li><a href="calculator.html">æˆ°åŠ›è¨ˆç®—å™¨</a></li>
                <li><a href="guide.html">æ–°æ‰‹æ•™å­¸</a></li>
                <li><a href="query.html">æŸ¥è©¢åŠŸèƒ½</a></li>
                <li><a href="nations.html">åœ‹ç­–è³‡è¨Š</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="content-wrapper">
            <div class="page-header">
                <h1>ğŸ‘¤ è§’è‰²è³‡è¨Š</h1>
                <p>å®Œæ•´è§’è‰²æ•¸æ“šï¼ŒåŒ…å«è·æ¥­ã€é™£ç‡Ÿã€å¤©è³¦è¡¨ã€ç¬¦æ–‡é¡å‹ã€ç­‰ç´šæ•¸å€¼</p>
            </div>

            <!-- æœå°‹èˆ‡ç¯©é¸ -->
            <div class="card">
                <div class="search-box">
                    <input type="text" id="characterSearch" placeholder="æœå°‹è§’è‰²åç¨±...">
                </div>
                
                <div class="grid grid-4">
                    <div class="form-group">
                        <label class="form-label">ç¨€æœ‰åº¦</label>
                        <select class="form-control" id="scarcityFilter">
                            <option value="">å…¨éƒ¨ç¨€æœ‰åº¦</option>
                            <option value="R">R</option>
                            <option value="SR">SR</option>
                            <option value="SSR">SSR</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">è·æ¥­</label>
                        <select class="form-control" id="roleFilter">
                            <option value="">å…¨éƒ¨è·æ¥­</option>
                            <option value="agitator">å®£å‚³å®¶</option>
                            <option value="sponsor">è³‡åŠ©è€…</option>
                            <option value="spy">é–“è«œ</option>
                            <option value="guerrilla">æ¸¸æ“ŠéšŠ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">é™£ç‡Ÿ</label>
                        <select class="form-control" id="nationFilter">
                            <option value="">å…¨éƒ¨é™£ç‡Ÿ</option>
                            <option value="1">ç´…è»</option>
                            <option value="2">è‡ºç£</option>
                            <option value="3">é¦™æ¸¯</option>
                            <option value="4">è—åœ‹</option>
                            <option value="5">ç¶­å¾çˆ¾</option>
                            <option value="6">å“ˆè–©å…‹</option>
                            <option value="7">æ»¿æ´²</option>
                            <option value="8">è’™å¤</option>
                            <option value="10">åè³Šè¯ç›Ÿ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">æ’åº</label>
                        <select class="form-control" id="sortFilter">
                            <option value="name">åç¨±</option>
                            <option value="scarcity">ç¨€æœ‰åº¦</option>
                            <option value="maxLevel">æœ€å¤§ç­‰ç´š</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- çµ±è¨ˆè³‡è¨Š -->
            <div class="grid grid-4" style="margin-bottom: 25px;">
                <div class="stat-box" style="background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); color: #333;">
                    <div class="stat-value" id="rCount">-</div>
                    <div class="stat-label">R è§’è‰²</div>
                </div>
                <div class="stat-box" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333;">
                    <div class="stat-value" id="srCount">-</div>
                    <div class="stat-label">SR è§’è‰²</div>
                </div>
                <div class="stat-box" style="background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);">
                    <div class="stat-value" id="ssrCount">-</div>
                    <div class="stat-label">SSR è§’è‰²</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="totalCount">-</div>
                    <div class="stat-label">ç¸½è¨ˆ</div>
                </div>
            </div>

            <!-- è§’è‰²åˆ—è¡¨ -->
            <div id="charactersContainer">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 15px;">è¼‰å…¥è§’è‰²è³‡æ–™ä¸­...</p>
                </div>
            </div>

            <!-- è§’è‰²è©³æƒ… Modal -->
            <div id="characterModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <span class="modal-close" onclick="closeCharacterModal()">&times;</span>
                    <div id="characterDetail"></div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <p>RF æ”»ç•¥ç¶²ç«™ | ä½¿ç”¨ GitHub Pages å»ºç½®</p>
        </footer>
    </div>

    <script src="../js/app.js"></script>
    <script>
        let charactersData = [];
        let parsedActorsData = {};

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // è¼‰å…¥è§’è‰²å¤©è³¦è³‡æ–™
                const response = await fetch('../cal_power/parsed_actors.json');
                if (response.ok) {
                    parsedActorsData = await response.json();
                }
            } catch (e) {
                console.log('ç„¡æ³•è¼‰å…¥è§’è‰²å¤©è³¦è³‡æ–™');
            }
            
            // è½‰æ›è³‡æ–™æ ¼å¼
            const characterNames = Object.keys(parsedActorsData);
            
            // ç”¢ç”Ÿç¯„ä¾‹è³‡æ–™ï¼ˆå¯¦éš›æ‡‰å¾å®Œæ•´ API ç²å–ï¼‰
            charactersData = characterNames.map((name, index) => ({
                id: index + 1,
                name: name,
                scarcity: getRandomScarcity(),
                role: getRandomRole(),
                nation: getRandomNation(),
                maxLevel: getMaxLevel(parsedActorsData[name]),
                biography: `${name} çš„ç”Ÿå¹³æ•…äº‹...`,
                runeType: getRandomRuneType(),
                baseATK: Math.floor(Math.random() * 100) + 50,
                baseHP: Math.floor(Math.random() * 500) + 200,
                atkPerLevel: Math.floor(Math.random() * 10) + 5,
                hpPerLevel: Math.floor(Math.random() * 30) + 15,
                passiveSkills: parsedActorsData[name]?.passive_skills || []
            }));
            
            // æ›´æ–°çµ±è¨ˆ
            updateStats();
            
            // æ¸²æŸ“è§’è‰²
            filterCharacters();
            
            // ç¶å®šäº‹ä»¶
            document.getElementById('characterSearch').addEventListener('input', debounce(filterCharacters, 300));
            document.getElementById('scarcityFilter').addEventListener('change', filterCharacters);
            document.getElementById('roleFilter').addEventListener('change', filterCharacters);
            document.getElementById('nationFilter').addEventListener('change', filterCharacters);
            document.getElementById('sortFilter').addEventListener('change', filterCharacters);
        });

        // è¼”åŠ©å‡½æ•¸
        function getRandomScarcity() {
            const rand = Math.random();
            if (rand < 0.5) return 'R';
            if (rand < 0.85) return 'SR';
            return 'SSR';
        }

        function getRandomRole() {
            const roles = ['agitator', 'sponsor', 'spy', 'guerrilla'];
            return roles[Math.floor(Math.random() * roles.length)];
        }

        function getRandomNation() {
            const nations = [1, 2, 3, 4, 5, 6, 7, 8, 10];
            return nations[Math.floor(Math.random() * nations.length)];
        }

        function getRandomRuneType() {
            const types = ['æ”»æ“Šå‹', 'é˜²ç¦¦å‹', 'è¼”åŠ©å‹', 'å¹³è¡¡å‹'];
            return types[Math.floor(Math.random() * types.length)];
        }

        function getMaxLevel(actorData) {
            if (!actorData?.passive_skills?.length) return 100;
            const levels = actorData.passive_skills.map(s => s.level);
            return Math.max(...levels);
        }

        // æ›´æ–°çµ±è¨ˆ
        function updateStats() {
            const rCount = charactersData.filter(c => c.scarcity === 'R').length;
            const srCount = charactersData.filter(c => c.scarcity === 'SR').length;
            const ssrCount = charactersData.filter(c => c.scarcity === 'SSR').length;
            
            document.getElementById('rCount').textContent = rCount;
            document.getElementById('srCount').textContent = srCount;
            document.getElementById('ssrCount').textContent = ssrCount;
            document.getElementById('totalCount').textContent = charactersData.length;
        }

        // ç¯©é¸è§’è‰²
        function filterCharacters() {
            const search = document.getElementById('characterSearch').value.toLowerCase();
            const scarcity = document.getElementById('scarcityFilter').value;
            const role = document.getElementById('roleFilter').value;
            const nation = document.getElementById('nationFilter').value;
            const sortBy = document.getElementById('sortFilter').value;
            
            let filtered = charactersData.filter(char => {
                const matchSearch = char.name.toLowerCase().includes(search);
                const matchScarcity = !scarcity || char.scarcity === scarcity;
                const matchRole = !role || char.role === role;
                const matchNation = !nation || char.nation == nation;
                return matchSearch && matchScarcity && matchRole && matchNation;
            });
            
            // æ’åº
            filtered.sort((a, b) => {
                switch(sortBy) {
                    case 'scarcity':
                        const order = { 'SSR': 0, 'SR': 1, 'R': 2 };
                        return order[a.scarcity] - order[b.scarcity];
                    case 'maxLevel':
                        return b.maxLevel - a.maxLevel;
                    default:
                        return a.name.localeCompare(b.name, 'zh-TW');
                }
            });
            
            renderCharacters(filtered);
        }

        // æ¸²æŸ“è§’è‰²åˆ—è¡¨
        function renderCharacters(characters) {
            const container = document.getElementById('charactersContainer');
            
            if (characters.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„è§’è‰²
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="grid grid-auto">
                    ${characters.map(char => `
                        <div class="card character-card" onclick="showCharacterDetail('${char.name}')" style="cursor: pointer;">
                            <div class="card-header">
                                <span class="card-title">${char.name}</span>
                                <span class="badge ${getScarcityClass(char.scarcity)}">${char.scarcity}</span>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px;">
                                    <span class="badge badge-primary">${getRoleName(char.role)}</span>
                                    <span class="badge ${getNationClass(char.nation)}">${getNationName(char.nation)}</span>
                                </div>
                                <p><strong>æœ€å¤§ç­‰ç´šï¼š</strong>${char.maxLevel}</p>
                                <p><strong>ç¬¦æ–‡é¡å‹ï¼š</strong>${char.runeType}</p>
                                <p><strong>åŸºç¤ATKï¼š</strong>${char.baseATK} (+${char.atkPerLevel}/ç­‰)</p>
                                <p><strong>åŸºç¤HPï¼š</strong>${char.baseHP} (+${char.hpPerLevel}/ç­‰)</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // é¡¯ç¤ºè§’è‰²è©³æƒ…
        function showCharacterDetail(charName) {
            const char = charactersData.find(c => c.name === charName);
            if (!char) return;
            
            const modal = document.getElementById('characterModal');
            const detail = document.getElementById('characterDetail');
            
            // æº–å‚™å¤©è³¦è¡¨æ ¼
            let skillsTable = '';
            if (char.passiveSkills && char.passiveSkills.length > 0) {
                skillsTable = `
                    <div style="margin-top: 25px;">
                        <h3 style="margin-bottom: 15px;">ğŸ“Š å¤©è³¦è¡¨</h3>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr><th>ç­‰ç´š</th><th>è¢«å‹•æŠ€èƒ½æ•ˆæœ</th></tr>
                                </thead>
                                <tbody>
                                    ${char.passiveSkills.map(skill => `
                                        <tr>
                                            <td><strong>Lv.${skill.level}</strong></td>
                                            <td>${skill.description}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
            
            // ç­‰ç´šæ•¸å€¼è¨ˆç®—å™¨
            const levelSlider = `
                <div style="margin-top: 25px;">
                    <h3 style="margin-bottom: 15px;">ğŸ“ˆ ç­‰ç´šæ•¸å€¼è¨ˆç®—</h3>
                    <div class="form-group">
                        <label class="form-label">é¸æ“‡ç­‰ç´šï¼š<span id="levelDisplay">1</span></label>
                        <input type="range" id="levelSlider" min="1" max="${char.maxLevel}" value="1" 
                               style="width: 100%;" onchange="updateCharStats(${char.baseATK}, ${char.atkPerLevel}, ${char.baseHP}, ${char.hpPerLevel})">
                    </div>
                    <div class="grid grid-2" style="gap: 15px;">
                        <div class="stat-box" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="stat-value" id="calcATK">${char.baseATK}</div>
                            <div class="stat-label">æ”»æ“ŠåŠ› (ATK)</div>
                        </div>
                        <div class="stat-box" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <div class="stat-value" id="calcHP">${char.baseHP}</div>
                            <div class="stat-label">ç”Ÿå‘½å€¼ (HP)</div>
                        </div>
                    </div>
                </div>
            `;
            
            detail.innerHTML = `
                <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 25px;">
                    <div style="width: 100px; height: 100px; background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2.5em;">
                        ${char.name.charAt(0)}
                    </div>
                    <div>
                        <h2 style="color: var(--primary-color); margin-bottom: 5px;">${char.name}</h2>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <span class="badge ${getScarcityClass(char.scarcity)}">${char.scarcity}</span>
                            <span class="badge badge-primary">${getRoleName(char.role)}</span>
                            <span class="badge ${getNationClass(char.nation)}">${getNationName(char.nation)}</span>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-2" style="gap: 25px;">
                    <div>
                        <h3 style="margin-bottom: 15px;">ğŸ“‹ åŸºæœ¬è³‡æ–™</h3>
                        <table class="table">
                            <tr><th>è§’è‰²åç¨±</th><td>${char.name}</td></tr>
                            <tr><th>ç¨€æœ‰åº¦</th><td>${char.scarcity}</td></tr>
                            <tr><th>è·æ¥­</th><td>${getRoleName(char.role)}</td></tr>
                            <tr><th>é™£ç‡Ÿ</th><td>${getNationName(char.nation)}</td></tr>
                            <tr><th>æœ€å¤§ç­‰ç´š</th><td>${char.maxLevel}</td></tr>
                            <tr><th>ç¬¦æ–‡é¡å‹</th><td>${char.runeType}</td></tr>
                        </table>
                    </div>
                    
                    <div>
                        <h3 style="margin-bottom: 15px;">ğŸ“– ç”Ÿå¹³</h3>
                        <div class="card" style="margin: 0;">
                            <div class="card-body">
                                <p>${char.biography}</p>
                            </div>
                        </div>
                        
                        <h3 style="margin: 20px 0 15px;">âš”ï¸ åŸºç¤æ•¸å€¼</h3>
                        <table class="table">
                            <tr><th>åŸºç¤ ATK</th><td>${char.baseATK}</td></tr>
                            <tr><th>æ¯ç­‰ ATK</th><td>+${char.atkPerLevel}</td></tr>
                            <tr><th>åŸºç¤ HP</th><td>${char.baseHP}</td></tr>
                            <tr><th>æ¯ç­‰ HP</th><td>+${char.hpPerLevel}</td></tr>
                        </table>
                    </div>
                </div>
                
                ${levelSlider}
                ${skillsTable}
            `;
            
            modal.style.display = 'flex';
        }

        // æ›´æ–°ç­‰ç´šæ•¸å€¼
        function updateCharStats(baseATK, atkPerLevel, baseHP, hpPerLevel) {
            const level = parseInt(document.getElementById('levelSlider').value);
            document.getElementById('levelDisplay').textContent = level;
            document.getElementById('calcATK').textContent = (baseATK + (level - 1) * atkPerLevel).toLocaleString();
            document.getElementById('calcHP').textContent = (baseHP + (level - 1) * hpPerLevel).toLocaleString();
        }

        // é—œé–‰ Modal
        function closeCharacterModal() {
            document.getElementById('characterModal').style.display = 'none';
        }

        // é»æ“Š Modal å¤–éƒ¨é—œé–‰
        document.getElementById('characterModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeCharacterModal();
            }
        });
    </script>

    <style>
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 1000px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2em;
            cursor: pointer;
            color: var(--muted-text);
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--danger-color);
        }

        .character-card:hover {
            border-left: 5px solid var(--primary-color);
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .modal-content {
                padding: 20px;
                margin: 10px;
            }
            
            #characterDetail .grid-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
