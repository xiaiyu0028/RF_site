<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="RF åŸé®è³‡è¨Š - æŸ¥çœ‹åŸé®è©³ç´°è³‡æ–™ã€åŠ‡æƒ…æ¨™é¡Œã€é€šé—œçå‹µèˆ‡æ‰è½ç‰©è³‡è¨Š">
    <title>åŸé®è³‡è¨Š - RF æ”»ç•¥ç¶²ç«™</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <!-- å°èˆªæ¬„ -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="../index.html" class="navbar-brand">
                âš”ï¸ RF æ”»ç•¥ç¶²ç«™
            </a>
            <button class="navbar-toggle" onclick="toggleMenu()">â˜°</button>
            <ul class="navbar-menu" id="navMenu">
                <li><a href="../index.html">é¦–é </a></li>
                <li><a href="cities.html" class="active">åŸé®è³‡è¨Š</a></li>
                <li><a href="characters.html">è§’è‰²è³‡è¨Š</a></li>
                <li><a href="calculator.html">æˆ°åŠ›è¨ˆç®—å™¨</a></li>
                <li><a href="guide.html">æ–°æ‰‹æ•™å­¸</a></li>
                <li><a href="query.html">æŸ¥è©¢åŠŸèƒ½</a></li>
                <li><a href="nations.html">åœ‹ç­–è³‡è¨Š</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="content-wrapper">
            <div class="page-header">
                <h1>ğŸ° åŸé®è³‡è¨Š</h1>
                <p>æŸ¥çœ‹åŸé®è©³ç´°è³‡æ–™ã€åŠ‡æƒ…æ¨™é¡Œã€é€šé—œçå‹µèˆ‡æ‰è½ç‰©è³‡è¨Š</p>
            </div>

            <!-- æœå°‹èˆ‡ç¯©é¸ -->
            <div class="card">
                <div class="search-box">
                    <input type="text" id="citySearch" placeholder="æœå°‹åŸé®åç¨±...">
                </div>
                
                <div class="grid grid-4">
                    <div class="form-group">
                        <label class="form-label">é™£ç‡Ÿç¯©é¸</label>
                        <select class="form-control" id="factionFilter">
                            <option value="">å…¨éƒ¨é™£ç‡Ÿ</option>
                            <option value="1">ç´…è»</option>
                            <option value="2">è‡ºç£</option>
                            <option value="3">é¦™æ¸¯</option>
                            <option value="4">è—åœ‹</option>
                            <option value="5">ç¶­å¾çˆ¾</option>
                            <option value="6">å“ˆè–©å…‹</option>
                            <option value="7">æ»¿æ´²</option>
                            <option value="8">è’™å¤</option>
                            <option value="10">åè³Šè¯ç›Ÿ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">æ’åºæ–¹å¼</label>
                        <select class="form-control" id="sortBy">
                            <option value="id">åŸé® ID</option>
                            <option value="name">åç¨±</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- åŸé®åˆ—è¡¨ -->
            <div id="citiesContainer">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 15px;">è¼‰å…¥åŸé®è³‡æ–™ä¸­...</p>
                </div>
            </div>

            <!-- åŸé®è©³ç´°è³‡è¨Š Modal -->
            <div id="cityModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <span class="modal-close" onclick="closeModal()">&times;</span>
                    <div id="cityDetail"></div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <p>RF æ”»ç•¥ç¶²ç«™ | ä½¿ç”¨ GitHub Pages å»ºç½®</p>
        </footer>
    </div>

    <script src="../js/app.js"></script>
    <script>
        let citiesData = [];

        // ç¯„ä¾‹åŸé®è³‡æ–™ï¼ˆå¯¦éš›æ‡‰å¾ API è¼‰å…¥ï¼‰
        const sampleCities = [
            {
                id: 1,
                name: "è‡ºåŒ—",
                owner: "è‡ºç£",
                ownerId: 2,
                chapter: "ç¬¬ä¸€ç« ",
                storyTitle: "åæ”»çš„åºæ›²",
                nextCity: "æ–°åŒ—",
                prevCity: null,
                firstClearReward: "é‡‘å¹£ x1000, æŠ½çåˆ¸ x5",
                clearReward: "é‡‘å¹£ x100",
                dropItems: [
                    { name: "é›é€ çŸ³", rate: "10%" },
                    { name: "ç¶“é©—è—¥æ°´", rate: "15%" }
                ],
                localSupport: "åŸºç¤æ´åŠ© +50%",
                territoryReward: "æ§åˆ¶çå‹µï¼šæ¯æ—¥é‡‘å¹£ x200"
            },
            {
                id: 37,
                name: "ç¶­å¤šåˆ©äºåŸ",
                owner: "é¦™æ¸¯",
                ownerId: 3,
                chapter: "ç¬¬äºŒç« ",
                storyTitle: "æµ·æ¸¯çš„é»æ˜",
                nextCity: "ä¹é¾",
                prevCity: "æ·±åœ³",
                firstClearReward: "é‡‘å¹£ x1500, æŠ½çåˆ¸ x8",
                clearReward: "é‡‘å¹£ x150",
                dropItems: [
                    { name: "å¼·åŒ–çŸ³", rate: "8%" },
                    { name: "ç¬¦æ–‡ç¢ç‰‡", rate: "12%" }
                ],
                localSupport: "åŸºç¤æ´åŠ© +80%",
                territoryReward: "æ§åˆ¶çå‹µï¼šæ¯æ—¥é‡‘å¹£ x350"
            },
            {
                id: 110,
                name: "çƒè˜­å·´æ‰˜",
                owner: "è’™å¤",
                ownerId: 8,
                chapter: "ç¬¬ä¸‰ç« ",
                storyTitle: "è‰åŸçš„å‘¼å–š",
                nextCity: "é”è˜­æœ­å¾·å˜å¾·",
                prevCity: "è˜‡èµ«å·´æ‰˜çˆ¾",
                firstClearReward: "é‡‘å¹£ x2000, æŠ½çåˆ¸ x10",
                clearReward: "é‡‘å¹£ x200",
                dropItems: [
                    { name: "ç¨€æœ‰ææ–™", rate: "5%" },
                    { name: "é¨å…µè£å‚™", rate: "7%" }
                ],
                localSupport: "åŸºç¤æ´åŠ© +100%",
                territoryReward: "æ§åˆ¶çå‹µï¼šæ¯æ—¥é‡‘å¹£ x500"
            },
            {
                id: 293,
                name: "åŒ—äº¬",
                owner: "ç´…è»",
                ownerId: 1,
                chapter: "æœ€çµ‚ç« ",
                storyTitle: "å¸éƒ½çš„çµ‚ç„‰",
                nextCity: null,
                prevCity: "å¤©æ´¥",
                firstClearReward: "é‡‘å¹£ x5000, æŠ½çåˆ¸ x20, SSRè§’è‰²ç¢ç‰‡ x50",
                clearReward: "é‡‘å¹£ x500",
                dropItems: [
                    { name: "å‚³èªªææ–™", rate: "2%" },
                    { name: "é™å®šè£å‚™", rate: "3%" }
                ],
                localSupport: "åŸºç¤æ´åŠ© +200%",
                territoryReward: "æ§åˆ¶çå‹µï¼šæ¯æ—¥é‡‘å¹£ x1000"
            },
            {
                id: 540,
                name: "é”è˜­è–©æ‹‰",
                owner: "è—åœ‹",
                ownerId: 4,
                chapter: "å¤–å‚³",
                storyTitle: "æµäº¡æ”¿åºœ",
                nextCity: null,
                prevCity: "æ‹‰è–©",
                firstClearReward: "é‡‘å¹£ x3000, ä½›ç  x100",
                clearReward: "é‡‘å¹£ x300",
                dropItems: [
                    { name: "ç¥è–ç¬¦æ–‡", rate: "4%" },
                    { name: "è—å¼è£å‚™", rate: "6%" }
                ],
                localSupport: "åŸºç¤æ´åŠ© +120%",
                territoryReward: "æ§åˆ¶çå‹µï¼šæ¯æ—¥é‡‘å¹£ x600"
            }
        ];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            citiesData = sampleCities;
            renderCities(citiesData);
            
            // ç¶å®šæœå°‹äº‹ä»¶
            document.getElementById('citySearch').addEventListener('input', debounce(filterCities, 300));
            document.getElementById('factionFilter').addEventListener('change', filterCities);
            document.getElementById('sortBy').addEventListener('change', filterCities);
        });

        // ç¯©é¸åŸé®
        function filterCities() {
            const searchText = document.getElementById('citySearch').value.toLowerCase();
            const faction = document.getElementById('factionFilter').value;
            const sortBy = document.getElementById('sortBy').value;
            
            let filtered = citiesData.filter(city => {
                const matchSearch = city.name.toLowerCase().includes(searchText);
                const matchFaction = !faction || city.ownerId == faction;
                return matchSearch && matchFaction;
            });
            
            // æ’åº
            filtered.sort((a, b) => {
                if (sortBy === 'name') {
                    return a.name.localeCompare(b.name, 'zh-TW');
                }
                return a.id - b.id;
            });
            
            renderCities(filtered);
        }

        // æ¸²æŸ“åŸé®åˆ—è¡¨
        function renderCities(cities) {
            const container = document.getElementById('citiesContainer');
            
            if (cities.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„åŸé®
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="grid grid-auto">
                    ${cities.map(city => `
                        <div class="card" onclick="showCityDetail(${city.id})" style="cursor: pointer;">
                            <div class="card-header">
                                <span class="card-title">${city.name}</span>
                                <span class="badge ${getNationClass(city.ownerId)}">${city.owner}</span>
                            </div>
                            <div class="card-body">
                                <p><strong>ç« ç¯€ï¼š</strong>${city.chapter}</p>
                                <p><strong>åŠ‡æƒ…ï¼š</strong>${city.storyTitle}</p>
                                <p><strong>æœ¬åœ°æ´åŠ©ï¼š</strong>${city.localSupport}</p>
                                <div style="margin-top: 15px;">
                                    <span class="badge badge-success">ID: ${city.id}</span>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // é¡¯ç¤ºåŸé®è©³æƒ…
        function showCityDetail(cityId) {
            const city = citiesData.find(c => c.id === cityId);
            if (!city) return;
            
            const modal = document.getElementById('cityModal');
            const detail = document.getElementById('cityDetail');
            
            detail.innerHTML = `
                <h2 style="color: var(--primary-color); margin-bottom: 20px;">
                    ğŸ° ${city.name}
                    <span class="badge ${getNationClass(city.ownerId)}" style="margin-left: 10px;">${city.owner}</span>
                </h2>
                
                <div class="grid grid-2" style="gap: 25px;">
                    <div>
                        <h3 style="margin-bottom: 15px;">ğŸ“– åŠ‡æƒ…è³‡è¨Š</h3>
                        <table class="table">
                            <tr><th>ç« ç¯€</th><td>${city.chapter}</td></tr>
                            <tr><th>åŠ‡æƒ…æ¨™é¡Œ</th><td>${city.storyTitle}</td></tr>
                            <tr><th>ä¸Šä¸€å€‹åŸé®</th><td>${city.prevCity || 'ç„¡'}</td></tr>
                            <tr><th>ä¸‹ä¸€å€‹åŸé®</th><td>${city.nextCity || 'ç„¡'}</td></tr>
                        </table>
                    </div>
                    
                    <div>
                        <h3 style="margin-bottom: 15px;">ğŸ çå‹µè³‡è¨Š</h3>
                        <table class="table">
                            <tr><th>é¦–æ¬¡é€šé—œ</th><td>${city.firstClearReward}</td></tr>
                            <tr><th>é€šé—œçå‹µ</th><td>${city.clearReward}</td></tr>
                            <tr><th>æœ¬åœ°æ´åŠ©</th><td>${city.localSupport}</td></tr>
                            <tr><th>æ“šé»æˆ°çå‹µ</th><td>${city.territoryReward}</td></tr>
                        </table>
                    </div>
                </div>
                
                <div style="margin-top: 25px;">
                    <h3 style="margin-bottom: 15px;">ğŸ“¦ æ‰è½ç‰©å“</h3>
                    <table class="table">
                        <thead>
                            <tr><th>ç‰©å“åç¨±</th><th>æ‰è½æ©Ÿç‡</th></tr>
                        </thead>
                        <tbody>
                            ${city.dropItems.map(item => `
                                <tr><td>${item.name}</td><td>${item.rate}</td></tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        // é—œé–‰ Modal
        function closeModal() {
            document.getElementById('cityModal').style.display = 'none';
        }

        // é»æ“Š Modal å¤–éƒ¨é—œé–‰
        document.getElementById('cityModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>

    <style>
        /* Modal æ¨£å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2em;
            cursor: pointer;
            color: var(--muted-text);
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--danger-color);
        }

        @media (max-width: 768px) {
            .modal-content {
                padding: 20px;
                margin: 10px;
            }
            
            #cityDetail .grid-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
